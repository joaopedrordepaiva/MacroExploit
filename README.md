# MacroExploit

This program utilizes Excel macros and VBA to decrypt passwords saved on Google Chrome in a Windows machine.
The software and code made available in this repository should not be utilized maliciously, but only for research and/or educational purposes.

There are two ways for the Excel to execute the code: 

1. PowerShell + Python 3

    Through this path, the Excel file will write a PowerShell script that grabs a key (decrypts it as well), users, urls and encypted passwords. It will also write a Python 3 script that uses the decrypted key to decrypt the passwords and write the output to a file. All files written by the Excel are located in %temp%, because files in this path are not usually scanned by Windows Defender, and are deleted automatically by the VBA. The execution of the scripts (see call to Shell function in the Excel VBA) is obfuscated by two calls to cmd.exe (on top of the one already done by the Excel), and three calls to PowerShell: one from the pipe, another from the command being piped and the final one is base64 encoded and passed to the -ENC flag. Within the final PowerShell call are the flags "-WindowStyle Hidden" and "-ExecutionPolicy Bypass", which allow undetected execution of the command that runs the PowerShell and Python 3 scripts.

2. C++

    Through this path, the Excel file will write a base64 obfuscated version of the executable from Sheet2 to a file in the %tmp% path. Then, the VBA base64 decodes the executable with the "certutil" command. Finally, it executes the decoded file and imports the output (another file in %temp%) into Sheet1. Sheet2 and all files produced are deleted to cover tracks and because Windows Defender may eventually detect the executable written by the VBA as a threat and signal the user (even though files in %temp% are not usually scanned by Windows Defender).

    To compile the executable yourself, your machine will need OpenSSL intalled in the path: "C:\OpenSSL-x64". If OpenSSL is located in another path in your machine, just modify the file "CompileAndExecute.bat" accordingly. After runing the "CompileAndExecute.bat" script, copy the contents of "bin\ExecutableInBase64.txt" to Sheet2 of the Excel by right-clicking the very first cell, selecting "Paste Special" and marking the "As Text" option. This way, strings that start with "+" or "=" will not be considered formulas.
